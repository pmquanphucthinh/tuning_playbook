{{#if this.polledRepositoryNeedsToBeUpdated}}
  <div {{did-insert this.handleDidInsertPolledRepositoryMismatchLoader}} class="{{@class}}">
    Loading...
  </div>
{{else}}
  <div {{did-insert this.handleDidInsert}} {{will-destroy this.handleWillDestroy}} class="{{@class}}">
    {{#each this.items key="identifier" as |item index|}}
      {{#if (eq item.type "SetupItem")}}
        <AnimatedContainer>
          {{#animated-if (eq index this.expandedItemIndex) use=this.transition duration=this.transitionDuration}}
            <CoursePage::StepList::SetupItem
              @course={{@course}}
              @class="mb-4"
              @willBeReplaced={{this.activeItemWillBeReplaced}}
              @repository={{@repository}}
              @onRepositoryCreate={{@onRepositoryCreate}}
              @preferredLanguageSlug={{@preferredLanguageSlug}}
            />
          {{else}}
            <CoursePage::StepList::CollapsedItem
              @class="mb-4"
              @number={{index}}
              @text="Repository Setup"
              @onClick={{this.handleCollapsedSetupItemClick}}
              @status={{if @repository.firstSubmissionCreated "completed" "active"}}
            />
          {{/animated-if}}
        </AnimatedContainer>
      {{/if}}

      {{#if (eq item.type "CourseStageItem")}}
        <AnimatedContainer>
          {{#animated-if (eq index this.expandedItemIndex) use=this.transition duration=this.transitionDuration}}
            <CoursePage::StepList::CourseStageItem
              @courseStage={{item.courseStage}}
              @repository={{@repository}}
              @class="mb-4"
              @onViewCommentsButtonClick={{@onViewCommentsButtonClick}}
              @onViewNextStageButtonClick={{this.handleViewNextStageButtonClick}}
              @onViewSolutionButtonClick={{@onViewSolutionButtonClick}}
              @onPublishToGithubButtonClick={{@onPublishToGithubButtonClick}}
              @onViewScreencastsButtonClick={{@onViewScreencastsButtonClick}}
              @shouldShowFeedbackPromptIfStageIsComplete={{item.shouldShowFeedbackPromptIfStageIsComplete}}
              @willBeReplaced={{this.activeItemWillBeReplaced}}
            />
          {{else}}
            <CoursePage::StepList::CollapsedItem
              @class="mb-4"
              @number={{index}}
              @text={{item.courseStage.name}}
              @status={{if (eq index this.activeItemIndex) "active" (if (gt index this.activeItemIndex) "future" "completed")}}
              @onClick={{fn this.handleCollapsedStageItemClick index}}
            />
          {{/animated-if}}
        </AnimatedContainer>
      {{/if}}

      {{#if (eq item.type "CourseCompletedItem")}}
        <AnimatedContainer>
          {{#animated-if (eq index this.expandedItemIndex) use=this.transition duration=this.transitionDuration}}
            <CoursePage::StepList::CourseCompletedItem
              @repository={{@repository}}
              @onPublishToGithubClick={{@onPublishToGithubButtonClick}}
              @class="mb-4"
            />
          {{else}}
            <CoursePage::StepList::CollapsedItem
              @class="mb-4"
              @text="Challenge Complete!"
              @status={{if (eq index this.activeItemIndex) "active" "completed"}}
              @onClick={{this.handleCollapsedCourseCompletedItemClick}}
            />
          {{/animated-if}}
        </AnimatedContainer>
      {{/if}}
    {{/each}}
  </div>
{{/if}}